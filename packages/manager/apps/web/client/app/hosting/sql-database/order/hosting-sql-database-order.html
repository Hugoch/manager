<oui-back-button
    data-on-click="$ctrl.goBack()">
    <span data-translate="hosting_sql_database_order_title"></span>
</oui-back-button>

<div data-ovh-alert="{{alerts.order}}"></div>

<div class="text-center"
        data-ng-if="$ctrl.loading.init">
    <oui-spinner data-size="l"></oui-spinner>
</div>

<div data-ng-if="!$ctrl.loading.init">
    <p data-translate="hosting_sql_database_order_description"></p>

    <oui-stepper name="sqlDatabaseOrderForm"
        data-on-finish="$ctrl.generateBc()">

        <!-- DB Type -->
        <oui-step-form
            data-header="{{:: 'hosting_sql_database_order_step_header_type' | translate }}">
            <oui-field
                data-label="{{:: 'hosting_sql_database_order_type' | translate }}">
                <oui-radio
                    data-ng-repeat="(key, value) in $ctrl.serviceOptions track by $index"
                    data-description="{{:: 'hosting_sql_database_order_type_' + key + '_text' | translate }}"
                    data-model="$ctrl.serviceOption"
                    data-value="key"
                    data-disabled="!value.length"
                    data-required>
                    <span data-translate="{{:: 'hosting_sql_database_order_type_' + key + '_label' | translate }}"></span>
                    <!-- data-ng-if="value.length" -->
                    <button class="oui-popover-button"
                        tabindex="0"
                        type="button"
                        data-oui-popover
                        data-oui-popover-scope="$ctrl"
                        data-oui-popover-template="{{:: 'hosting_sql_database_order_' + key + '.html' }}">
                    </button>
                </oui-radio>
            </oui-field>
        </oui-step-form>

        <script type="text/ng-template" id="hosting_sql_database_order_privateSQL.html">
            <p data-translate="hosting_sql_database_order_type_privateSQL_popover_title"></p>
            <ul>
                <li data-translate="hosting_sql_database_order_type_privateSQL_popover_line_1"></li>

                <!-- TODO: Need to change values (see infos from API) -->
                <li data-translate="hosting_sql_database_order_type_privateSQL_popover_line_2"
                    data-translate-values="{ t0: item.tooltips.rams.min, t1: item.tooltips.rams.max }">
                </li>
                <li data-translate="hosting_sql_database_order_type_privateSQL_popover_line_3"></li>
                <li data-translate="hosting_sql_database_order_type_privateSQL_popover_line_4"></li>
                <li data-translate="hosting_sql_database_order_type_privateSQL_popover_line_5"></li>
                <li data-translate="hosting_sql_database_order_type_privateSQL_popover_line_6"></li>
            </ul>

        </script>

        <script type="text/ng-template" id="hosting_sql_database_order_startSQL.html">
            <p data-translate="hosting_sql_database_order_type_startSQL_popover_title"></p>
            <ul>
                <li data-translate="hosting_sql_database_order_type_startSQL_popover_line_1"></li>
                <li data-translate="hosting_sql_database_order_type_startSQL_popover_line_2"></li>
                <li data-translate="hosting_sql_database_order_type_startSQL_popover_line_3"></li>
                <li data-translate="hosting_sql_database_order_type_startSQL_popover_line_4"></li>
            </ul>
        </script>

        <!-- Customization -->
        <oui-step-form
            data-header="{{:: 'hosting_sql_database_order_step_header_customize' | translate }}">

            <!-- Pack (startSQL) -->
            <oui-field
                data-ng-if="$ctrl.isStart()"
                data-label="{{:: 'hosting_sql_database_order_domains_pack' | translate }}"
                data-help-text="{{:: 'hosting_sql_database_order_type_startSQL_hosting_info' | translate }}"
                data-size="xl">
                <div class="oui-select oui-select_inline">
                    <select class="oui-select__input" id="startDbVersion" name="startDbVersion" required
                            data-ng-change="$ctrl.getDuration()"
                            data-ng-model="$ctrl.model.dbPack"
                            data-ng-options="version as ((('hosting_sql_database_order_domains_pack_value_' + version.replace('.', '') | translate) == 'hosting_sql_database_order_domains_pack_value_' + version.replace('.', ''))? version: ('hosting_sql_database_order_domains_pack_value_' + version.replace('.', '') | translate)) for version in $ctrl.getData($ctrl.model.type).dbPack track by version"
                            data-required>
                        <option value="" disabled
                                data-translate="select_option"></option>
                    </select>
                    <span class="oui-icon oui-icon-chevron-down" aria-hidden="true"></span>
                </div>
            </oui-field>

            <!-- Version (privateSQL) -->
            <oui-field
                data-ng-if="$ctrl.isCloudDbOrPrivateDb()"
                data-label="{{:: 'hosting_sql_database_order_version' | translate }}"
                data-size="xl">
                <oui-select id="orderVersion" name="orderVersion"
                    data-model="$ctrl.model.version"
                    data-items="$ctrl.getData($ctrl.model.type).versions"
                    data-required>
                    <span data-ng-bind="((('hosting_sql_database_order_version_value_' + $item.replace('.', '') | translate) === 'hosting_sql_database_order_version_value_' + $item.replace('.', ''))? $item : ('hosting_sql_database_order_version_value_' + $item.replace('.', '') | translate))"></span>
                </oui-select>
            </oui-field>

            <!-- RAM (privateSQL) -->
            <oui-field
                data-ng-if="$ctrl.isCloudDbOrPrivateDb()"
                data-label="{{:: 'hosting_sql_database_order_ram' | translate }}"
                data-size="xl">
                <oui-select id="orderRam" name="orderRam"
                    data-model="$ctrl.model.ram"
                    data-items="$ctrl.getData($ctrl.model.type).rams"
                    data-required>
                    {{$item}}
                    <!-- <span data-ng-bind="$ctrl.getNormalizedRAMSize($item)"></span> -->
                </oui-select>
            </oui-field>

            <!-- Hosting (startSQL, privateSQL) -->
            <oui-field
                data-ng-if="!$ctrl.isCloudDb()"
                data-label="{{:: 'hosting_sql_database_order_hosting' | translate }}"
                data-help-text="{{:: 'hosting_sql_database_order_hosting_help' | translate }}"
                data-size="xl">
                <oui-select id="orderHosting" name="orderHosting"
                    data-model="$ctrl.selectedHosting"
                    data-items="$ctrl.getData($ctrl.model.type).hostings"
                    data-match="displayName">
                    <!-- data-required> -->
                </oui-select>
            </oui-field>

            <!-- DataCenter (privateSQL) -->
            <oui-field
                data-ng-if="$ctrl.isPrivateDb() && $ctrl.model.hosting === $ctrl.noHostValue"
                data-label="{{:: 'hosting_sql_database_order_datacenter' | translate }}"
                data-help-text="{{:: 'hosting_sql_database_order_no_hosting_warning' | translate }}"
                data-size="xl">
                <oui-select id="orderDc" name="orderDc"
                    data-model="$ctrl.model.datacenter"
                    data-items="$ctrl.getData($ctrl.model.type).datacenters"
                    data-required>
                    <span data-translate="{{::'hosting_sql_database_order_datacenter_value_' + $item }}"></span>
                </oui-select>
            </oui-field>
        </oui-step-form>

        <!-- Duration -->
        <oui-step-form
            data-header="{{:: 'hosting_sql_database_order_step_header_duration' | translate }}"
            data-loading="$ctrl.loading.durations && $ctrl.loading.prices"
            data-on-focus="$ctrl.getDuration()">
            <oui-message data-type="warning"
                data-ng-if="$ctrl.shouldDisplayFreeDbWarning()">
                <h3 class="h5" data-translate="hosting_sql_database_order_included_title"></h3>
                <span data-translate="hosting_sql_database_order_included_info"
                        data-translate-values="{
                        t0: '<strong>' + $ctrl.selectedHosting.name + '</strong>',
                        }">
                </span>
                <a href="{{$ctrl.makeHostingUrl($ctrl.selectedHosting.name)}}"
                    data-translate="hosting_sql_database_order_included_link"></a>
            </oui-message>

            <div role="alert" data-ng-if="$ctrl.model.version && $ctrl.model.ram"
                    data-ovh-alert="{{alerts.durations}}"
                    data-ovh-alert-hide-remove-button>
            </div>

            <oui-field
                data-label="{{:: 'hosting_sql_database_order_duration' | translate }}">
                <oui-radio
                    name="interval"
                    data-ng-repeat="duration in $ctrl.getData($ctrl.model.type).durations track by $index"
                    data-model="$ctrl.model.duration"
                    data-value="duration.duration"
                    data-on-change="$ctrl.resetOrder()"
                    data-required>
                    <span data-ng-bind=":: duration.duration | wucDuration:'longDate'"></span>&nbsp;:&nbsp;
                    <ovh-manager-order-catalog-price
                        data-price="duration.details.prices.withoutTax.value"
                        data-tax="duration.details.prices.tax.value"
                        data-user="$ctrl.user">
                    </ovh-manager-order-catalog-price>
                </oui-radio>
            </oui-field>

            <fieldset>
                <legend class="border-0"
                        data-translate="hosting_sql_database_order_duration"></legend>
                <div class="oui-radio"
                        data-ng-repeat="duration in $ctrl.getData($ctrl.model.type).durations track by $index">
                    <input type="radio" class="oui-radio__input" name="durationRadio[$index]" id="durationRadio-{{$index}}" required
                            data-ng-click="contractsValidated = false"
                            data-ng-change="$ctrl.resetOrder()"
                            data-ng-disabled="$ctrl.loading.prices || $ctrl.durations.length === 1"
                            data-ng-model="$ctrl.model.duration"
                            data-ng-value="duration.duration">
                    <label class="oui-radio__label-container" for="durationRadio-{{$index}}">
                        <span class="oui-radio__label">
                            <span data-ng-bind="duration.duration | wucDuration:'longDate'"></span>&nbsp;:
                            <span data-ng-bind-html="duration.details.prices | price:$ctrl.user.ovhSubsidiary"></span>
                            <oui-spinner data-size="s"
                                        data-ng-if="!duration.details.prices"></oui-spinner>
                        </span>
                    </label>
                </div>
            </fieldset>
        </oui-step-form>

        <!-- Payment / Activation -->
        <oui-step-form
            data-header="{{:: $ctrl.isOptionFree ? 'hosting_sql_database_order_step_header_activation' : 'hosting_sql_database_order_step_header_payment' | translate }}"
            data-description="{{:: ($ctrl.isOptionFree ? 'hosting_sql_database_order_step_description_activation' : 'hosting_sql_database_order_step_description_payment') | translate }}"
            data-submit-text="{{:: ($ctrl.isOptionFree ? 'hosting_sql_database_order_submit_activate' : 'hosting_sql_database_order_submit_pay') | translate }}"
            data-cancel-text="{{:: 'hosting_sql_database_order_cancel' | translate }}"
            data-valid="$ctrl.canOrder() || $ctrl['canOrder' + $ctrl.getData($ctrl.model.type).key]()"
            data-prevent-next>

            <!-- Contracts -->
            <ovh-manager-order-contracts
                name="contractsValidated"
                data-ng-if="$ctrl.getDurationDetails($ctrl.model.type, $ctrl.model.duration).contracts.length > 0"
                data-items="$ctrl.getDurationDetails($ctrl.model.type, $ctrl.model.duration).contracts"
                data-model="$ctrl.model.contract">
            </ovh-manager-order-contracts>
        </oui-step-form>
    </oui-stepper>
</div>
